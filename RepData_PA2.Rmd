---
title: "Storm Data Analysis - Peer Assessment 2"
author: ""
date: "July 20, 2014"
output: html_document
---
## Synopsis
 >>>describes and summarizes your analysis in at most 10 complete sentences.

This data analysis uses the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. 
to address the following questions:

1.  Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?

2. Across the United States, which types of events have the greatest economic consequences?

## Data Processing

### Download storm data, documentation and FAQ

Set working directory:
``` {r setwd, echo = TRUE}
setwd("~/GitHub/RepData_PeerAssessment2")
```
Create a data subdirectory if it does not exist:
``` {r subdirectory, echo = TRUE} 
if (!file.exists("data")) {
        dir.create("data")
}
```
Download *Storm Data* and unzip if it isn't already there:
``` {r download dataset, echo = TRUE}
library(R.utils)       #for bzunzip
fileDir <- "./data/"
fileZipName <- "repdata-data-StormData.csv.bz2"
fileName <- "repdata-data-StormData.csv"
fileUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"

filePath <- paste0(fileDir, fileZipName)
if (!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method ="curl")
        bunzip2(filePath, exdir=fileDir, remove=FALSE)
        dateDownloaded <- date()
}
```
Download documentation files:  *National Weather Service Storm Data Documentation* and *National Climatic Data Center Storm Events FAQ*
```{r download documentation, echo = TRUE}
fileName2 <- "repdata-peer2_doc-pd01016005curr.pdf"
fileUrl2 <- "https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf"
filePath2 <- paste0(fileDir, fileName2) 
if (!file.exists(filePath2)) {
        download.file(fileUrl2, destfile = filePath2, method ="curl")
        dateDownloaded <- date()
}

fileName3 <- "repdata-peer2_doc-NCDC Storm Events-FAQ Page.pdf"
fileUrl3 <- "https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf"
filePath3 <- paste0(fileDir, fileName3) 
if (!file.exists(filePath3)) {
        download.file(fileUrl3, destfile = filePath3, method ="curl")
        dateDownloaded <- date()
}
```

### Read in data file, subset and clean
``` {r read dataset, echo = TRUE}
raw <- read.csv(paste0(fileDir, fileName))
data <- subset(raw, na.omit=TRUE, select=c(EVTYPE, FATALITIES, INJURIES, PROPDMG,PROPDMGEXP))
```

## Results

The analysis document must have at least one figure containing a plot.

Your analyis must have no more than three figures. Figures may have multiple plots in them (i.e. panel plots), but there cannot be more than three figures total.

```{r results, echo = TRUE}

injured <- with(data, tapply(INJURIES, EVTYPE, sum))
injured <- sort(injured, decreasing = TRUE)
top20_injured <- head(injured, n=20L)
most_injuries <- as.data.frame(top20_injured)
colnames(most_injuries) <- c("injuries")

dead <- with(data, tapply(FATALITIES, EVTYPE, sum))
dead <- sort(dead, decreasing = TRUE)
top20_dead <- head(dead, n=20L)

barplot(top20_injured, main="Car Distribution", horiz=TRUE)
        
library(ggplot2)
ploti <- ggplot(most_injuries, aes(row.names)) +
        geom_bar() + coord_flip()


        geom_bar(stat="identity") + 
        facet_grid(. ~ year) +
        scale_x_discrete(breaks=NULL) +                              # suppress x-axis label
        labs(x="---total emission levels indicated by dashed lines---") +
        theme(axis.title.x = element_text(colour = "#990000"),
              axis.title.y = element_text(colour = "black")) +
        labs(y="PM2.5 Emissions (in tons)") +
        labs(title="Baltimore City, Maryland | Motor Vehicle PM2.5 Emissions") + 
        labs(fill = "Vehicle Type")


 <- by(data, factorw,                              # per factor, calc mean steps per interval
                function(x) {                           
                        tapply(x$steps, x$interval, mean)
                }

```

