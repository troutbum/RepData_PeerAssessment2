---
title: "Storm Data Analysis - Peer Assessment 2"
author: ""
date: "July 20, 2014"
output: html_document
---
## Synopsis
 >>>describes and summarizes your analysis in at most 10 complete sentences.

This data analysis uses the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. 
to address the following questions:

1.  Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?

2. Across the United States, which types of events have the greatest economic consequences?

## Data Processing

### Download storm data, documentation and FAQ

Set working directory:
``` {r setwd, echo = TRUE}
setwd("~/GitHub/RepData_PeerAssessment2")
```
Create a data subdirectory if it does not exist:
``` {r subdirectory, echo = TRUE} 
if (!file.exists("data")) {
        dir.create("data")
}
```
Download *Storm Data* and unzip if it isn't already there:
``` {r download dataset, echo = TRUE}
library(R.utils)       #for bzunzip
fileDir <- "./data/"
fileZipName <- "repdata-data-StormData.csv.bz2"
fileName <- "repdata-data-StormData.csv"
fileUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"

filePath <- paste0(fileDir, fileZipName)
if (!file.exists(filePath)) {
        download.file(fileUrl, destfile = filePath, method ="curl")
        bunzip2(filePath, exdir=fileDir, remove=FALSE)
        dateDownloaded <- date()
}
```
Download documentation files:  *National Weather Service Storm Data Documentation* and *National Climatic Data Center Storm Events FAQ*
```{r download documentation, echo = TRUE}
fileName2 <- "repdata-peer2_doc-pd01016005curr.pdf"
fileUrl2 <- "https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf"
filePath2 <- paste0(fileDir, fileName2) 
if (!file.exists(filePath2)) {
        download.file(fileUrl2, destfile = filePath2, method ="curl")
        dateDownloaded <- date()
}

fileName3 <- "repdata-peer2_doc-NCDC Storm Events-FAQ Page.pdf"
fileUrl3 <- "https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf"
filePath3 <- paste0(fileDir, fileName3) 
if (!file.exists(filePath3)) {
        download.file(fileUrl3, destfile = filePath3, method ="curl")
        dateDownloaded <- date()
}
```

### Read in data file, subset and clean
``` {r read dataset, echo = TRUE}
raw <- read.csv(paste0(fileDir, fileName))
data <- subset(raw, na.omit=TRUE, select=c(EVTYPE, FATALITIES, INJURIES, PROPDMG, PROPDMGEXP))
```

### 
```{r}
library(lattice)
injured_by_event <- tapply(data$INJURIES, data$EVTYPE, sum, simplify = TRUE)    # simply returns a scalar not list
injured_by_event <- sort(injured_by_event, decreasing = TRUE)
top_injury_events <- head(injured_by_event, n=20L)

top_injury_events <- sort(top_injury_events, decreasing = FALSE)                # reverse sort order
barchart(top_injury_events, xlab='Injuries', main='Total Injuries by Weather Event')


deaths_by_event <- tapply(data$FATALITIES, data$EVTYPE, sum, simplify = TRUE)   # simply returns a scalar not list
deaths_by_event <- sort(deaths_by_event, decreasing = TRUE)
top_death_events <- head(deaths_by_event, n=20L)

top_death_events <- sort(top_death_events, decreasing = FALSE)                  # reverse sort order
barchart(top_death_events, col="red", xlab='Deaths', main='Total Deaths by Weather Event')

```



## Results

The analysis document must have at least one figure containing a plot.

Your analyis must have no more than three figures. Figures may have multiple plots in them (i.e. panel plots), but there cannot be more than three figures total.

```{r results, echo = TRUE}


```

